<!DOCTYPE html>
<html lang="ptbr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOBANKING</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="shortcut icon" href="../imagens/logo.ico" type="image/x-icon">
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/usuarioConfig.css">
    <link rel="stylesheet" href="../css/default.css">
</head>

<body onload="exibirDados()">
    <div id="frame" class="frame-aplicacao" style="display: flex;">
        <nav class="menu-lateral">
            <h2 class="titulo-menu">Menu</h2>
            <ul id="menuLateralBox">
                <li>
                    <a href="card.html">
                        <span class="icon-menu"><i class="fa-solid fa-server"></i></span>
                        <span class="titulo-link-menu">Máquinas</span>
                    </a>
                </li>
                <li>
                    <a href="dashboard.html">
                        <span class="icon-menu"><i class="fa-solid fa-chart-simple"></i></span>
                        <span class="titulo-link-menu">Gráficos</span>
                    </a>
                </li>
               
                <li>
                    <a href="alertas.html">
                        <span class="icon-menu"><i class="fa-solid fa-triangle-exclamation"></i></span>
                        <span class="titulo-link-menu">Alertas</span>
                    </a>
                </li>
            </ul>

            <div class="name-menu">
                <a href="usuarioInfo.html">
                    <h2 id="nome_perfil_menu"></h2>
                </a>
            </div>
        </nav>
        <div class="conteudo">

            <h1>Usuário</h1>

            <span class="title-dados-user">Dados do usuário</span>
            <span class="linha-title-dados"></span>

            <div class="form-box">
                <form action="">
                    <label for="email">
                        E-mail
                        <input id="email" value="maikon@gmail.com" type="email">
                    </label>
                    <label for="nome">
                        Nome
                        <input id="nome" value="Maikon Douglas Da Silva" type="text">
                    </label>
                    <label for="telefone">
                        Nova Senha
                        <input id="senha" value="" type="password">
                    </label>
                    <label for="senha">
                        Confirmar senha
                        <input id="confirmarSenha" value="" type="password">
                    </label>


                </form>
                <button onclick="confirmar()">Editar</button>
            </div>
        </div>
    </div>

    <div class="confirmarModal" id="confirmarModal">
        <h2>Deseja realmente editar seus dados ?</h2>
        <div>
            <button onclick="fechar(), editarUsuario()" class="simButon">Sim</button>
            <button onclick="fechar()" class="naoButon">Não</button>
        </div>
    </div>
</body>

</html>

<script>

const menuLaterealHTML = document.getElementById('menuLateralBox')
  var sessTipoUsuario = sessionStorage.ID_TIPO_USUARIO
  if(sessTipoUsuario == 1){
    menuLaterealHTML.innerHTML += `
     <li>
          <a href="funcionarios.html">
            <span class="icon-menu"><i class="fa-solid fa-user"></i></span>
            <span class="titulo-link-menu">Funcionários</span>
          </a>
        </li>
    `
  }

    nome_perfil_menu.innerHTML = sessionStorage.NOME_USUARIO

    function confirmar() {

        confirmarModal.style.top = '0'
        const frame = document.getElementById('frame');
        frame.classList.add('blur-grid')

    }

    function fechar() {

        const frame = document.getElementById('frame');
        frame.classList.remove('blur-grid')
        confirmarModal.style.top = '-20%'
    }

    function editarUsuario() {


        var emailVar = email.value
        var nomeVar = nome.value
        var senhaVar = senha.value

        var idUsuario = sessionStorage.ID_USUARIO

        if (email.value == "" || nome.value == "" || senha.value == "" || confirmarSenha.value == "") {
            alert("Preencha todos os campos!")
        } else if (senha.value != confirmarSenha.value) {
            alert("Senha Inválida")
        } else {
            fetch(`/usuarios/editarUsuario/${idUsuario}`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    emailServer: emailVar,
                    nomeServer: nomeVar,
                    senhaServer: senhaVar
                }),
            }).then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {


                    alert("Edição Realizada com Sucesso!")



                } else {
                    console.log(resposta);
                    throw "Houve um erro ao tentar realizar a edição!";
                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
                return false;
            });
        }

    }

    function exibirDados() {

        var nomeUsuario = sessionStorage.NOME_USUARIO
        var emailUsuario = sessionStorage.EMAIL_USUARIO

        nome.value = nomeUsuario
        email.value = emailUsuario
    }

</script>